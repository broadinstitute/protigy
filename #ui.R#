################################################################################################################
## Filename: global.r
## Created: October 09, 2015
## Author(s): Karsten Krug
##
## Purpose: Shiny-app to perform differential expression analysis, primarily on proteomics data, to perform
##          simple data QC, to interactively browse through the results and to download high-quality result
##          figures.
##
## This file defines the two panels of the user interface.
##
################################################################################################################
library(shiny)

##################################################################
## user interface
##################################################################
##shinyUI(fluidPage(theme = "bootstrap.min.css",
shinyUI(
    fluidPage(

        ##includeCSS("www/style.css"),
##      tags$src("<script src=\"www/MailtoComposeInGMail.user.js\"></script>"),

        headerPanel('', windowTitle=paste("modT (v",VER,")",sep='')),

        fluidRow(
            column(10,
                   titlePanel(paste(APPNAME, " (v",VER,") - Differential Expression Analysis using Moderated T-Statistics", sep=''))
                   ),
            column(2,
                  img(src='BroadProteomicsLogo.png', height=68, width=200)
                   )
        ),
        tags$hr(), ##tags$br(),

        fluidRow(

            ############################################################################
            ##
            ##                            LEFT panel
            ##
            ############################################################################
            column(3, fluidRow(wellPanel(

                          ###############################
                          ## file upload
                          uiOutput("file.upload"),

                          ###############################
                          ## import session
                          uiOutput("import.session"),

                          ## #############################
                          ## browse saved sessions
                          uiOutput("browse.sessions"),

                          ###############################
                          ## test data set
                          ##uiOutput("file.testdata"),

                          ###############################
                          ## id column
                          uiOutput("choose.id.column"),

                          ###############################
                          ## define groups
                          uiOutput("define.groups"),

                          ###############################
                          ## show experimental design
                          uiOutput("list.groups"),

                          ###############################
                          ## filter type
                          tags$br(),
                          uiOutput("filter.type"),
                          uiOutput("filter.value"),


                          ## top N
                          ##conditionalPanel(condition = "input['filter.type'] == 'top.n'",  numericInput( "top.n", "Top N features", value=50, min=2, step=1)),
                          ##conditionalPanel(condition = "input['filter.type'] == 'top.n'",  numericInput( "filter.value.top.n", "Top N features", value=50, min=2, step=1)),


                          ## nom p
                          ##conditionalPanel(condition = "input['filter.type'] == 'nom.p' & input['run.test'] > '0'", numericInput( "p.val", "P-value filter", value=0.01, min=0, max=1, step=1e-3)),
                          #conditionalPanel(condition = "input['filter.type'] == 'nom.p'", numericInput( "filter.value.nom.p", "P-value filter", value=0.01, min=0, max=1, step=1e-2)),
                          ##conditionalPanel(condition = "input[['filter.type']] == 'nom.p'", numericInput( "filter.value.nom.p", "P-value filter", value="global.param[['filter.value']]", min=0, max=1, step=1e-2)),
                          ## adj p
                          ##conditionalPanel(condition = "input['filter.type'] == 'adj.p'", numericInput( "adj.p", "Corrected P-Value (FDR)", value=0.05, min=0, max=1, step=1e-3)),
                                        #conditionalPanel(condition = "input['filter.type'] == 'adj.p'", numericInput( "filter.value.adj.p", "Corrected P-Value (FDR)", value=0.05, min=0, max=1, step=1e-2)),
                          ##conditionalPanel(condition = "input['filter.type'] == 'adj.p'", numericInput( "filter.value.adj.p", "Corrected P-Value (FDR)", value="output['filter.value']", min=0, max=1, step=1e-2)),

                          ###############################
                          ## export session
                          ##uiOutput("export.session"),

                          ###############################
                          ## export ALL results, i.e. figures + tables
                          ##uiOutput("export.all.results"),

                          ###############################
                          ## F5 hint
                          tags$br(),
                          htmlOutput('F5hint'),
                          tags$br(),



                          ##########################################################
                          ## Email footer: works for Gmail only
                          ##########################################################
                          HTML(paste('<footer>Ran into problems?  <a href=\"https://mail.google.com/mail/?view=cm&fs=1&to=karsten@broadinstitute.org&su=Shiny%20modTv',VER,'%20problem&body=%0D%0A%0D%0A%0D%0A',paste(rep('-', 30), collapse=''),'%0D%0AMachine:', Sys.info()['nodename'],'%0D%0AApp:', APPNAME, '%0D%0AVersion:', VER, '%0D%0A','\" target=\"_blank\">Send me an email</a></footer>', sep=''))
                      )##,


                      ##@########################################################
                      ## Broad Proteomics logo
                      ## fluidRow(
                      ##     column(2),
                      ##     column(8,
                      ##            img(src='BroadProteomicsLogo.png', height=68, width=200)),
                      ##     column(2)
                      ## )

                      ) ## end wellPanel
                   ),

            ############################################################################
            ##
            ##                            RIGHT panel
            ##
            ############################################################################
            column(9,

                   htmlOutput('error'),
                   htmlOutput('help.start' ),
                   htmlOutput('help.id.column' ),
                   htmlOutput('help.exp.design' ),
                   htmlOutput('help.test' ),

                   htmlOutput('help.results'),

                   ## the actual content
                   uiOutput('navbar')

                   ) ## end column

        ) ## end end fluidRow


    ) ## end fluidPage
) ## end shinyUI
